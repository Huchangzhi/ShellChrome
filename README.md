# 控制台浏览器 (ShellChrome)

基于 Puppeteer 的 Node.js 中文控制台浏览器，支持通过命令行控制 Chrome 浏览器。

## 功能特性

- ✅ **标签页管理**：打开、关闭、切换标签页
- ✅ **页面导航**：导航到指定 URL（自动补充协议）
- ✅ **元素查看**：获取页面快照，查看所有元素或可交互元素
- ✅ **交互操作**：点击按钮、输入文本
- ✅ **截图功能**：一键截图保存到 ./image.png
- ✅ **终端预览**：彩色色块/文字叠加/ASCII 艺术三种预览模式
- ✅ **动态刷新**：实时连续截图预览（按 ESC 退出）
- ✅ **自动化录制**：录制操作序列并自动回放

## 环境要求

- Node.js >= 20
- Google Chrome 浏览器（稳定版）
- npm

## 安装

```bash
# 进入项目目录
cd console-browser

# 安装依赖
npm install
```

## 使用方法

### 启动程序

```bash
npm start
```

或者：

```bash
node index.js
```

### 编译为可执行文件

```bash
# 打包 + 编译 (Windows/Linux/Mac)
npm run bundle
npm run build:nexe

# 编译后的可执行文件位于 ./dist/shellchrome
```

### 快捷命令

| 命令 | 说明 | 示例 |
|------|------|------|
| `o <url>` | 打开新标签页（自动补充 https://） | `o baidu.com` |
| `q` | 关闭当前标签页 | `q` |
| `p` | 显示所有标签页 | `p` |
| `w <id>` | 切换到指定标签页 | `w 123` |
| `n <url>` | 在当前页导航 | `n github.com` |
| `l` | 获取所有元素（自动先获取快照） | `l` |
| `lc` | 获取可交互元素（按钮/输入框/链接） | `lc` |
| `s` | 截图保存到 ./image.png | `s` |
| `sp` | 截图并在终端显示（彩色色块） | `sp` |
| `spw` | **连续截图预览**（动态刷新，按 ESC 退出） | `spw` |
| `st` | 截图并在终端显示（彩色色块 + 文字） | `st` |
| `stw` | **连续截图显示文字**（动态刷新，按 ESC 退出） | `stw` |
| `sa` | 截图并在终端显示（ASCII） | `sa` |
| `c <uid>` | 点击元素 | `c 1_5` |
| `t <uid> <text>` | 输入文本 | `t 1_10 你好` |
| `k <key>` | 发送键盘按键 | `k Enter` |
| `ui` | 配置 UI 模式（需重启生效） | `ui on` |
| `a h` | 显示自动化帮助 | `a h` |
| `a s` | 开始录制自动化 | `a s` |
| `a e` | 结束录制并保存 | `a e` |
| `a l` | 列出所有自动化脚本 | `a l` |
| `a a <编号>` | 执行指定编号的自动化 | `a a 1` |
| `h` | 显示帮助 | `h` |
| `x` | 退出程序 | `x` |

### 常用按键

| 按键 | 说明 |
|------|------|
| `Enter` | 回车键 |
| `Tab` | 制表键 |
| `Escape` | 退出键 |
| `ArrowUp` | 上箭头 |
| `ArrowDown` | 下箭头 |
| `ArrowLeft` | 左箭头 |
| `ArrowRight` | 右箭头 |
| `Control+A` | 全选 |
| `Control+C` | 复制 |
| `Control+V` | 粘贴 |
| `F5` | 刷新页面 |

## 使用示例

### 示例 1：打开网页并查看

```
🌐 > o baidu.com
[浏览器] 正在打开新标签页：https://baidu.com
[浏览器] 标签页已打开，ID: 1

🌐 > l
[浏览器] 正在获取页面快照...
[浏览器] 快照获取成功

========== 页面元素列表 ==========
[1_0] RootWebArea "百度一下，你就知道" url="https://www.baidu.com/"
[1_1] image "百度 logo"
[1_2] textbox "搜索"
[1_3] button "百度一下"
...
=====================================
```

### 示例 2：填写表单并提交

```
🌐 > o https://example.com/login

🌐 > l
[1_10] textbox "用户名"
[1_11] textbox "密码"
[1_12] button "登录"

🌐 > t 1_10 myusername
🌐 > t 1_11 mypassword
🌐 > c 1_12
```

### 示例 3：快速查看可交互元素

```
🌐 > lc

========== 可交互元素 ==========
[1_2] textbox "搜索"
[1_3] button "百度一下"
[1_4] link "新闻"
[1_5] link "地图"
...
=====================================
```

### 示例 4：多标签页操作

```
🌐 > o google.com
🌐 > o github.com
🌐 > p
========== 标签页列表 ==========
[1] 百度 [当前]
[2] Google
[3] GitHub
===============================

🌐 > w 2
[浏览器] 正在切换到标签页：2 (Google)

🌐 > q
[浏览器] 正在关闭标签页：1
```

### 示例 5：截图

```
🌐 > s
[浏览器] 正在截图...
截图已保存到：./image.png
```

### 示例 6：自动化录制与回放

```
# 开始录制，输入名字"打开洛谷"
🌐 > a s
请输入自动化脚本的名字：
> 打开洛谷
✅ 已开始录制自动化："打开洛谷"
   请执行操作（点击、输入等），使用 a e 结束录制

# 执行的操作会被记录（l、lc、s 系列查看命令不会记录）
🌐 > o luogu.com.cn
✅ 已打开 luogu.com.cn

# 结束录制
🌐 > a e
✅ 已保存自动化脚本："打开洛谷" (编号：1)
   共录制 1 条命令

# 查看自动化列表
🌐 > a l
========== 自动化脚本列表 ==========
  [1] 打开洛谷 - 1 条命令 - 创建于：2026-02-23 10:30:00
=====================================

# 执行自动化（每个命令间隔 1 秒）
🌐 > a a 1
▶️ 开始执行自动化："打开洛谷"
   共 1 条命令
  [1/1] 执行：o luogu.com.cn
✅ 自动化执行完成："打开洛谷"
```

## 快捷键

- `Ctrl + C`：退出程序

## 常见问题

### 1. 启动失败，提示找不到 chrome-devtools-mcp

确保已运行 `npm install` 安装依赖。

### 2. Chrome 浏览器无法启动

- 确保已安装 Chrome 浏览器（稳定版）
- 检查 Chrome 是否已正确安装在默认路径

### 3. 元素 UID 找不到

- 先使用 `l` 命令获取最新页面快照
- 页面内容变化后需要重新获取快照

## 技术原理

本项目基于 `chrome-devtools-mcp` 构建，通过 MCP (Model Context Protocol) 协议与 Chrome DevTools 通信，实现浏览器自动化控制。

核心流程：
1. 启动 MCP 服务器（chrome-devtools-mcp）
2. 通过 stdio 传输建立连接
3. 调用各种工具（tools）控制浏览器
4. 解析响应并显示结果

## 许可证

MIT License
